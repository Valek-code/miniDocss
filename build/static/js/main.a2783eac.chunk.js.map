{"version":3,"sources":["components/TextEditor.js","App.js","index.js"],"names":["TextEditor","useState","socket","setSocket","quill","setQuill","docID","useParams","id","useEffect","PORT","process","s","io","disconnect","handler","delta","oldDelta","source","emit","on","off","updateContents","once","document","setContents","enable","interval","setInterval","getContents","clearInterval","TOOLBAR_OPTIONS","header","font","list","color","background","script","aling","wrapperRef","useCallback","wrapper","innerHTML","editor","createElement","append","q","Quill","theme","modules","toolbar","setText","handlePDF","e","a","preventDefault","pdfExporter","generatePdf","pdfAsBlob","saveAs","split","className","ref","Button","style","marginLeft","variant","onClick","href","window","location","App","path","exact","to","uuid","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.a2783eac.chunk.js","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react'\r\nimport Quill from 'quill'\r\nimport {io} from 'socket.io-client'\r\nimport \"quill/dist/quill.snow.css\"\r\nimport '../App.css'\r\nimport { useParams } from 'react-router'\r\nimport {Button} from '@material-ui/core'\r\nimport { saveAs } from 'file-saver';\r\nimport { pdfExporter } from 'quill-to-pdf';\r\n\r\nconst TextEditor = () => {\r\n\r\n    const [socket, setSocket] = useState()\r\n    const [quill, setQuill] = useState()\r\n    const {id: docID} = useParams()\r\n\r\n    useEffect(() => {\r\n        const PORT = process.env.PORT || 4000\r\n        const s = io(`http://localhost:${PORT}`)\r\n        setSocket(s)\r\n\r\n        return () => {\r\n            s.disconnect()\r\n        }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if(socket == null || quill == null) return\r\n        const handler = (delta, oldDelta, source) => {\r\n            if( source !== 'user') return\r\n\r\n            socket.emit(\"send-changes\", delta)\r\n        }\r\n\r\n        quill.on('text-change', handler)\r\n\r\n        return () => {\r\n            quill.off('text-change', handler)\r\n        }\r\n    }, [socket, quill])\r\n\r\n    useEffect(() => {\r\n        if(socket == null || quill == null) return\r\n        const handler = (delta) => {\r\n            quill.updateContents(delta)\r\n        }\r\n\r\n        socket.on('receive-changes', handler)\r\n\r\n        return () => {\r\n            socket.off('receive-changes', handler)\r\n        }\r\n    }, [socket, quill])\r\n\r\n\r\n    useEffect(() => {\r\n        if(socket == null || quill == null) return\r\n        \r\n        socket.once('load-document', document => {\r\n            quill.setContents(document)\r\n            quill.enable()\r\n        })\r\n\r\n        socket.emit('get-document', docID)\r\n\r\n    }, [socket, quill, docID])\r\n\r\n    useEffect(() => {\r\n        if(socket == null || quill == null) return\r\n\r\n\r\n        const interval = setInterval(() => {\r\n            socket.emit(\"save-document\", quill.getContents())\r\n        }, 300000)\r\n        \r\n        return () => clearInterval(interval)\r\n\r\n    }, [socket, quill])\r\n\r\n    const handleSave = e => {\r\n        e.preventDefault();\r\n        socket.emit(\"save-document\", quill.getContents())\r\n    }\r\n\r\n    const TOOLBAR_OPTIONS = [\r\n        [{header: [1,2,3,4,5,6 ,false]}],\r\n        [{font: []}],\r\n        [{list : \"ordered\"}, {list:\"bullet\"}],\r\n        [{color: []}, {background: []}],\r\n        [{script: \"sub\"}, {script: \"super\"}],\r\n        [{aling: []}],\r\n        [\"image\", \"blockquote\", \"code-block\"], \r\n        [\"clean\"]\r\n    ]\r\n\r\n    const wrapperRef = useCallback((wrapper) => {\r\n        if(wrapper == null) return \r\n        wrapper.innerHTML = \"\"\r\n        const editor = document.createElement('div')\r\n        wrapper.append(editor)\r\n        const q = new Quill(editor, {theme: \"snow\", modules: {\r\n            toolbar: TOOLBAR_OPTIONS\r\n        }})\r\n        q.enable(false)\r\n        q.setText(\"Loading... \")\r\n        setQuill(q);\r\n        \r\n        \r\n    }, [])\r\n\r\n    const handlePDF = async e => {\r\n        e.preventDefault()\r\n        const delta = quill.getContents(); \r\n        const pdfAsBlob = await pdfExporter.generatePdf(delta); \r\n        saveAs(pdfAsBlob, `${docID.split('-')[0]}.pdf`); \r\n    }\r\n    \r\n\r\n    return (\r\n        <>\r\n        \r\n        <div className=\"container\" ref={wrapperRef}><div>Invite a friend</div></div>\r\n        \r\n        <Button\r\n        style={{marginLeft:\"1rem\"}}\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n        onClick={handleSave}\r\n        >Save document</Button>\r\n        <Button\r\n        style={{marginLeft:\"1rem\"}}\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n        onClick={handlePDF}\r\n        >Generate PDF</Button>\r\n        <h1 style={{marginLeft:\"1rem\"}}>Invite a friend: <a href={`${window.location.href}`}>{window.location.href}</a></h1>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default TextEditor\r\n","import './App.css';\nimport io from 'socket.io-client'\nimport {TextField, Button} from '@material-ui/core'\nimport {useState, useEffect, useRef} from 'react'\nimport TextEditor from './components/TextEditor';\nimport {v4 as uuid} from 'uuid'\n\nimport {BrowserRouter as Router, Switch, Route, Redirect} from 'react-router-dom'\n\n\nfunction App() {\n  \n\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/\" exact>\n          <Redirect to={`/doc/${uuid()}`} />\n        </Route>\n        <Route path='/doc/:id'>\n          <TextEditor />\n        </Route>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}